<% layout("layout/boilerplate") %>

<div class="container mt-5">
  <h2 class="mb-4 text-center">All Admins</h2>

  <% if (admins.length > 0) { %> <% admins.forEach((admin, index) => { %>
  <div class="card mb-4 shadow-sm border-0">
    <!-- Card Header -->
    <div
      class="card-header bg-dark text-white d-flex justify-content-between align-items-center"
    >
      <div><i class="fas fa-user-shield me-2"></i> <%= admin.username %></div>
      <div class="d-flex gap-2">
        <!-- Restrict/Unrestrict Button -->
        <p
          class="p-2 rounded align-items-center m-0 px-3 <%= admin.restricted ? 'bg-warning' : 'bg-success' %>"
          id="restrictBtn"
          data-bs-toggle="modal"
          data-bs-target="#confirmRestrictModal<%= admin._id %>"
        >
          <i class="fas <%= admin.restricted ? 'fa-lock' : 'fa-unlock' %>"></i>
        </p>

        <!-- Confirm Restrict/Unrestrict Modal -->
        <div
          class="modal fade"
          id="confirmRestrictModal<%= admin._id %>"
          tabindex="-1"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div
                class="modal-header <%= admin.restricted ? 'bg-success' : 'bg-warning' %> text-white"
              >
                <h5 class="modal-title">
                  <%= admin.restricted ? 'Unrestrict Admin' : 'Restrict Admin'
                  %>
                </h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <p class="fw-bold text-center text-dark">
                  Are you sure you want to <%= admin.restricted ? 'unrestrict' :
                  'restrict' %>
                  <strong><%= admin.username %></strong>?
                </p>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
                <form
                  action="/creator/dashboard/<%= admin._id %>/restrict"
                  method="POST"
                >
                  <button
                    type="submit"
                    class="btn <%= admin.restricted ? 'btn-success' : 'btn-warning' %>"
                  >
                    Yes, <%= admin.restricted ? 'Unrestrict' : 'Restrict' %>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Delete Button -->
        <p
          type="button"
          id="deleteIcon"
          class="d-flex bg-danger p-2 rounded align-items-center m-0 px-3"
          data-bs-toggle="modal"
          data-bs-target="#confirmDeleteModal<%= admin._id %>"
        >
          <i class="fas fa-trash me-1 text-center"></i>
        </p>
      </div>
    </div>

    <!-- Card Body -->
    <div class="card-body">
      <% if (admin.clients && admin.clients.length > 0) { %>
      <!-- Dropdown Button -->
      <button
        class="btn btn-sm btn-outline-dark mb-3"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#clients<%= index %>"
        aria-expanded="false"
        aria-controls="clients<%= index %>"
      >
        View Clients (<%= admin.clients.length %>)
      </button>

      <!-- Collapsible Clients List -->
      <div class="collapse" id="clients<%= index %>">
        <ul class="list-group">
          <% admin.clients.forEach(client => { %>
          <li class="list-group-item">
            <strong><%= client.name %></strong> - <%= client.email || "No email"
            %><br />
            <small>
              Phone: <%= client.phone %> | Bank: <%= client.bank %> | Amount:
              <%= client.amount %> <%= client.currency %> | Status:
              <span
                class="badge <% if (client.status === 'successful') { %> bg-success <% } else if (client.status === 'declined') { %> bg-danger <% } else { %> bg-warning text-dark <% } %>"
              >
                <%= client.status %>
              </span>
              <a
                href="/link-info/<%= client.transactionId %>"
                class="btn btn-warning fw-bold ms-1"
              >
                <i class="fas fa-info-circle me-1"></i> Check Updates
              </a>
            </small>
          </li>
          <% }) %>
        </ul>
      </div>
      <% } else { %>
      <p class="text-muted">No clients assigned to this admin yet.</p>
      <% } %>
    </div>
  </div>

  <!-- Confirm Delete Modal (outside card for cleaner layout) -->
  <div
    class="modal fade"
    id="confirmDeleteModal<%= admin._id %>"
    tabindex="-1"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">Confirm Delete</h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p class="text-danger">
            Are you sure you want to delete
            <strong><%= admin.username %></strong>
            and all their clients? This action cannot be undone.
          </p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <form action="/creator/admins/<%= admin._id %>/delete" method="POST">
            <button type="submit" class="btn btn-danger">Yes, Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <% }) %> <% } else { %>
  <p class="text-muted">No admins created yet.</p>
  <% } %>
</div>
